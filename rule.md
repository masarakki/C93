## ルール

操作内容は後に紹介するとして、まずはルールのみを列挙していきます。

### リポジトリのあつかい

- リポジトリは、必ず自分の**個人アカウントにフォークする**
- フォーク元のリポジトリには**pushしてはいけない**

`ghq` コマンドを使うと無意識にこの状態になります。

### デフォルトブランチ

github-flowで *master* ブランチとなっている箇所は、デフォルトブランチと言い換えます。
これは、Gitの **HEAD branch** と同じもので、可能であるなら *master* ブランチであるべきです。

例外を挙げると、オープンソースのソフトウェアであるである `tootsuite/mastodon` をフォークし、**カスタマイズしたもの**を公開する場合、
*master* ブランチではなく自分たち固有のブランチ名をデフォルトブランチとし、そのブランチでカスタマイズ開発をしたほうが良いでしょう[^1]。

- デフォルトブランチは**常にデプロイ可能**にする
- デフォルトブランチへの変更は、必ずプルリクエストで行い、**絶対に直接コミットしてはいけない**

[^1]: カスタマイズを *master* ブランチで行うとおそらく地獄を見ます

### 開発とプルリクエスト

- デフォルトブランチからブランチを切り、開発する
- (開発段階で**[WIP]**を付けてプルリクエストし、レビューを受けながら開発する)
- プルリクエストは徹底的にレビューする
- プルリクエストを自動テストする仕組み(**CI**)を必ず導入する
- プルリクエストのブランチを**開発環境にデプロイ**し、実際に使って動作確認する

コミットとプルリクエストは次節で詳しく解説します。

### プルリクエストの取り込み

プルリクエストを取り込む瞬間は、コードにバグを混入させないための最後の砦です。
どれだけ慎重になっても十分ということはありません。

- 最終的に、プルリクエストは**必ずsquashする**
- 徹底的に最終確認する
- 完璧にOKとなったら[WIP]を外す
- プルリクエストをマージしたら**すぐデプロイする**

### 大規模な変更の場合

大規模な変更、例えば**リニューアル**の場合、リニューアル専用のブランチをつくります。
リニューアルブランチを**デフォルトブランチとみなし**、同じようにプルリクエストによる開発をします。

リニューアルブランチの開発が終わったら、本来のデフォルトブランチから**マージ用ブランチ**を切り、リニューアルブランチをマージし、必要であればコンフリクトを解消し、それをプルリクエストします。
この方法はgit-flowの**リリースブランチ**と似ているかもしれません。

なぜリニューアルブランチを直接プルリクエストせず、2ステップにするかというと、
おそらくリニューアルブランチ作業中にも本来のデフォルトブランチにも様々なコミットが入り、その場合**リニューアルブランチを最新のデフォルトブランチにrebaseするのがダルい**からです。

フォーク元の新バージョン対応などの場合も同様で、リニューアルブランチではなくフォーク元の特定のバージョン[^2]に変わっただけです。
デフォルトブランチから切ったマージ用ブランチに対象バージョンをマージし、**大量のコンフリクトを解消し**、プルリクエストします。

[^2]: おそらくタグによってバージョンが切られているでしょう
